#!/usr/bin/env bash
gosu "$APPLICATION_USER" composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition /app
gosu "$APPLICATION_USER" /app/bin/magento setup:install \
    --backend-frontname=admin \
    --amqp-host=172.17.0.1 \
    --amqp-port=5672 \
    --amqp-user=rabbitmq \
    --amqp-password=rabbitmq \
    --amqp-virtualhost=/ \
    --consumers-wait-for-messages=1 \
    --db-host=172.17.0.1 \
    --db-name=magento \
    --db-user=magento \
    --db-password=magento \
    --session-save=redis \
    --session-save-redis-host=172.17.0.1 \
    --session-save-redis-port=6379 \
    --session-save-redis-db=1 \
    --session-save-redis-log-level=7 \
    --cache-backend=redis \
    --cache-backend-redis-server=172.17.0.1 \
    --cache-backend-redis-db=2 \
    --cache-backend-redis-port=6379 \
    --cache-backend-redis-compress-data=1 \
    --cache-id-prefix=dev_ \
    --page-cache=redis \
    --page-cache-redis-server=172.17.0.1 \
    --page-cache-redis-db=3 \
    --page-cache-redis-port=6379 \
    --page-cache-redis-compress-data=1 \
    --page-cache-redis-compression-lib=1 \
    --page-cache-id-prefix=dev_ \
    --base-url=http://magento.localhost/ \
    --language=pt_BR \
    --timezone=America/Sao_Paulo \
    --currency=BRL \
    --use-rewrites=1 \
    --use-secure=1 \
    --base-url-secure=https://magento.localhost/ \
    --use-secure-admin=1 \
    --admin-user=marcio.maciel \
    --admin-password=evino5357 \
    --admin-email=marcio.maciel@evino.com.br \
    --admin-firstname=Marcio \
    --admin-lastname=Maciel \
    --search-engine=elasticsearch7 \
    --elasticsearch-host=172.17.0.1 \
    --elasticsearch-port=9200 \
    --elasticsearch-enable-auth=0 \
    --disable-modules="Magento_TwoFactorAuth"
